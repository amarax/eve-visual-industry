import{V as Je,X as Pe,S as le,i as ne,s as ue,L,M as U,e as B,t as Z,k as Q,j as ie,c as O,a as w,g as W,d as k,n as z,m as re,b as q,f as G,D as T,o as oe,h as fe,O as H,x,u as $,v as se,T as J,U as Ye,H as ge,Z as Ke,y as Xe,C as Ze,F as ce,G as ye,I as Te,l as _e,N as We,_ as xe,E as $e,ac as et,w as tt,P as it,Q as rt,R as ot,$ as st,ad as at,ae as lt,r as nt,af as ut,K as ft}from"../../chunks/vendor-c867dc14.js";import{M as ct,a as _t,C as pt,b as Ee,p as dt,g as ht}from"../../chunks/IndustryJob-3570b195.js";import{m as Be,P as Oe,k as mt,n as Se,d as we,I as gt,U as yt,L as vt,R as bt}from"../../chunks/LocationSelector-31fe7db1.js";import"../../chunks/singletons-12a22614.js";import"../../chunks/paths-28a87002.js";let ae=new Map,ve=Je(ae,e=>{ae.size===0&&mt("invMarketGroups").then(t=>{ae.clear();for(let i of t)i.parent_group_id=="None"&&delete i.parent_group_id,ae.set(i.market_group_id,i);e(ae)}).catch(t=>console.error(t))});function Ge(e,t){let i=[...t.keys()].filter(o=>t.get(o).parent_group_id==e),r=[];for(const o of i)r=[...r,...Ge(o,t)];return new Set([...i,...r])}const be=Pe(ve,e=>{let t=new Map;for(const[i,r]of e)t.set(i,Ge(i,e));return t});function Ve(e,t,i,r){var l;let o=[];return[e,...(l=t.get(e))!=null?l:[]].forEach(s=>{var y,m;o=[...o,...(m=(y=i.get(s))==null?void 0:y.filter(v=>r.has(v)))!=null?m:[]]}),o}const Rt=Pe([ve,be,Be,Oe],([e,t,i,r])=>{let o=new Map;for(const[l,s]of e){let y=Ve(l,t,i,r);(y==null?void 0:y.length)>0&&o.set(l,s)}return o});function kt(e){var A;let t,i,r=((A=e[9].types[e[3]])==null?void 0:A.name)+"",o,l,s,y,m,v=Se(e[1])+"",u,a,d,g=we(e[2])+"",h,b,_,C,I,c;function S(f){e[13](f)}let Y={type_id:e[3],quantity:e[8].producedQuantity,totalCost:e[8].totalCost,buyOverheadRate:-e[4],sellOverheadRate:-e[5]-e[4],extents:e[6]};return e[0][e[3]]!==void 0&&(Y.price=e[0][e[3]]),C=new ct({props:Y}),L.push(()=>U(C,"price",S)),{c(){t=B("div"),i=B("a"),o=Z(r),y=Q(),m=B("div"),u=Z(v),a=Q(),d=B("div"),h=Z(g),b=Q(),_=B("div"),ie(C.$$.fragment),this.h()},l(f){t=O(f,"DIV",{class:!0,title:!0});var M=w(t);i=O(M,"A",{href:!0});var E=w(i);o=W(E,r),E.forEach(k),M.forEach(k),y=z(f),m=O(f,"DIV",{class:!0});var F=w(m);u=W(F,v),F.forEach(k),a=z(f),d=O(f,"DIV",{class:!0});var P=w(d);h=W(P,g),P.forEach(k),b=z(f),_=O(f,"DIV",{class:!0});var p=w(_);re(C.$$.fragment,p),p.forEach(k),this.h()},h(){var f;q(i,"href",l=`/breakdown/${e[3]}`),q(t,"class","itemName svelte-1dxbxfs"),q(t,"title",s=`${(f=e[9].types[e[3]])==null?void 0:f.name} [${e[3]}]`),q(m,"class","metric svelte-1dxbxfs"),q(d,"class","metric svelte-1dxbxfs"),q(_,"class","graph")},m(f,M){G(f,t,M),T(t,i),T(i,o),G(f,y,M),G(f,m,M),T(m,u),G(f,a,M),G(f,d,M),T(d,h),G(f,b,M),G(f,_,M),oe(C,_,null),c=!0},p(f,[M]){var F,P;(!c||M&520)&&r!==(r=((F=f[9].types[f[3]])==null?void 0:F.name)+"")&&fe(o,r),(!c||M&8&&l!==(l=`/breakdown/${f[3]}`))&&q(i,"href",l),(!c||M&520&&s!==(s=`${(P=f[9].types[f[3]])==null?void 0:P.name} [${f[3]}]`))&&q(t,"title",s),(!c||M&2)&&v!==(v=Se(f[1])+"")&&fe(u,v),(!c||M&4)&&g!==(g=we(f[2])+"")&&fe(h,g);const E={};M&8&&(E.type_id=f[3]),M&256&&(E.quantity=f[8].producedQuantity),M&256&&(E.totalCost=f[8].totalCost),M&16&&(E.buyOverheadRate=-f[4]),M&48&&(E.sellOverheadRate=-f[5]-f[4]),M&64&&(E.extents=f[6]),!I&&M&9&&(I=!0,E.price=f[0][f[3]],H(()=>I=!1)),C.$set(E)},i(f){c||(x(C.$$.fragment,f),c=!0)},o(f){$(C.$$.fragment,f),c=!1},d(f){f&&k(t),f&&k(y),f&&k(m),f&&k(a),f&&k(d),f&&k(b),f&&k(_),se(C)}}}function It(e,t,i){let r,o,l=ge,s=()=>(l(),l=Ye(r,c=>i(8,o=c)),r),y,m,v;J(e,_t,c=>i(11,y=c)),J(e,gt,c=>i(12,m=c)),J(e,yt,c=>i(9,v=c)),e.$$.on_destroy.push(()=>l());let{productTypeId:u=null}=t,{prices:a}=t,{facilityModifiers:d}=t,{salesTaxRate:g=.036}=t,{brokerFeeRate:h=.0113709973928}=t,{profitRatio:b=0}=t,{profitPerDay:_=0}=t,{extents:C=[0,1e3]}=t;function I(c){e.$$.not_equal(a[u],c)&&(a[u]=c,i(0,a))}return e.$$set=c=>{"productTypeId"in c&&i(3,u=c.productTypeId),"prices"in c&&i(0,a=c.prices),"facilityModifiers"in c&&i(10,d=c.facilityModifiers),"salesTaxRate"in c&&i(4,g=c.salesTaxRate),"brokerFeeRate"in c&&i(5,h=c.brokerFeeRate),"profitRatio"in c&&i(1,b=c.profitRatio),"profitPerDay"in c&&i(2,_=c.profitPerDay),"extents"in c&&i(6,C=c.extents)},e.$$.update=()=>{e.$$.dirty&4104&&s(i(7,r=pt(u))),e.$$.dirty&2176&&r.update({indexPrices:y}),e.$$.dirty&129&&r.update({prices:a}),e.$$.dirty&1152&&d&&r.update({facilityModifiers:d}),e.$$.dirty&256&&i(1,b=(o==null?void 0:o.profit)/(o==null?void 0:o.totalCost)),e.$$.dirty&256&&i(2,_=(o==null?void 0:o.profit)*(24*60*60)/(o==null?void 0:o.jobDuration))},[a,b,_,u,g,h,C,r,o,v,d,y,m,I]}class Mt extends le{constructor(t){super();ne(this,t,It,kt,ue,{productTypeId:3,prices:0,facilityModifiers:10,salesTaxRate:4,brokerFeeRate:5,profitRatio:1,profitPerDay:2,extents:6})}}function Ct(e){let t,i,r,o,l,s,y;function m(h){e[7](h)}function v(h){e[8](h)}function u(h){e[9](h)}function a(h){e[10](h)}function d(h){e[11](h)}let g={activity:e[2]};return e[1]!==void 0&&(g.value=e[1]),e[0].systemCostIndex!==void 0&&(g.activitySystemCostIndex=e[0].systemCostIndex),e[0].taxRate!==void 0&&(g.activityTax=e[0].taxRate),e[3]!==void 0&&(g.structureRoleBonuses=e[3]),e[4]!==void 0&&(g.structureRigBonuses=e[4]),t=new vt({props:g}),L.push(()=>U(t,"value",m)),L.push(()=>U(t,"activitySystemCostIndex",v)),L.push(()=>U(t,"activityTax",u)),L.push(()=>U(t,"structureRoleBonuses",a)),L.push(()=>U(t,"structureRigBonuses",d)),{c(){ie(t.$$.fragment)},l(h){re(t.$$.fragment,h)},m(h,b){oe(t,h,b),y=!0},p(h,[b]){const _={};b&4&&(_.activity=h[2]),!i&&b&2&&(i=!0,_.value=h[1],H(()=>i=!1)),!r&&b&1&&(r=!0,_.activitySystemCostIndex=h[0].systemCostIndex,H(()=>r=!1)),!o&&b&1&&(o=!0,_.activityTax=h[0].taxRate,H(()=>o=!1)),!l&&b&8&&(l=!0,_.structureRoleBonuses=h[3],H(()=>l=!1)),!s&&b&16&&(s=!0,_.structureRigBonuses=h[4],H(()=>s=!1)),t.$set(_)},i(h){y||(x(t.$$.fragment,h),y=!0)},o(h){$(t.$$.fragment,h),y=!1},d(h){se(t,h)}}}function Dt(e,t,i){let r,{facilityModifiers:o={systemCostIndex:.05,taxRate:10}}=t,l,s,{value:y}=t,{activity:m}=t,v=Ke("locations");J(e,v,_=>i(6,r=_));let u=Ze(r);Xe("locations",u);function a(_){y=_,i(1,y)}function d(_){e.$$.not_equal(o.systemCostIndex,_)&&(o.systemCostIndex=_,i(0,o),i(3,l),i(4,s))}function g(_){e.$$.not_equal(o.taxRate,_)&&(o.taxRate=_,i(0,o),i(3,l),i(4,s))}function h(_){l=_,i(3,l)}function b(_){s=_,i(4,s)}return e.$$set=_=>{"facilityModifiers"in _&&i(0,o=_.facilityModifiers),"value"in _&&i(1,y=_.value),"activity"in _&&i(2,m=_.activity)},e.$$.update=()=>{if(e.$$.dirty&9&&(l?i(0,o.roleModifiers={jobDuration:l.jobDurationModifier,materialConsumption:l.materialConsumptionModifier,jobCost:l.jobCostModifier},o):delete o.roleModifiers),e.$$.dirty&17&&(s?i(0,o.rigModifiers={materialReduction:s.materialReductionBonus,timeReduction:s.timeReductionBonus,costReduction:s.costReductionBonus},o):delete o.rigModifiers),e.$$.dirty&68&&r)switch(m){case bt:const _=35835;let C=Object.values(r).filter(I=>(I==null?void 0:I.type_id)==_).map(I=>[I==null?void 0:I.type_id,I]);u.set(Object.fromEntries(C));break;default:u.set(r)}},[o,y,m,l,s,v,r,a,d,g,h,b]}class Pt extends le{constructor(t){super();ne(this,t,Dt,Ct,ue,{facilityModifiers:0,value:1,activity:2})}}function Ne(e,t,i){const r=e.slice();return r[7]=t[i],r[9]=i,r}function Ae(e,t,i){const r=e.slice();return r[10]=t[i].market_group_id,r[11]=t[i].name,r}function je(e){let t,i=e[11]+"",r,o;return{c(){t=B("option"),r=Z(i),this.h()},l(l){t=O(l,"OPTION",{});var s=w(t);r=W(s,i),s.forEach(k),this.h()},h(){t.__value=o=e[10],t.value=t.__value},m(l,s){G(l,t,s),T(t,r)},p(l,s){s&2&&i!==(i=l[11]+"")&&fe(r,i),s&2&&o!==(o=l[10])&&(t.__value=o,t.value=t.__value)},d(l){l&&k(t)}}}function qe(e){let t,i,r,o,l,s,y,m=[...e[7]],v=[];for(let a=0;a<m.length;a+=1)v[a]=je(Ae(e,m,a));function u(...a){return e[6](e[9],...a)}return{c(){t=B("select"),i=B("option");for(let a=0;a<v.length;a+=1)v[a].c();this.h()},l(a){t=O(a,"SELECT",{name:!0});var d=w(t);i=O(d,"OPTION",{}),w(i).forEach(k);for(let g=0;g<v.length;g+=1)v[g].l(d);d.forEach(k),this.h()},h(){i.__value=r=null,i.value=i.__value,q(t,"name",o=e[9].toString())},m(a,d){G(a,t,d),T(t,i);for(let g=0;g<v.length;g+=1)v[g].m(t,null);ce(t,e[2][e[9]]),s||(y=ye(t,"change",u),s=!0)},p(a,d){if(e=a,d&2){m=[...e[7]];let g;for(g=0;g<m.length;g+=1){const h=Ae(e,m,g);v[g]?v[g].p(h,d):(v[g]=je(h),v[g].c(),v[g].m(t,null))}for(;g<v.length;g+=1)v[g].d(1);v.length=m.length}d&6&&l!==(l=e[2][e[9]])&&ce(t,e[2][e[9]])},d(a){a&&k(t),Te(v,a),s=!1,y()}}}function Tt(e){let t,i=e[1],r=[];for(let o=0;o<i.length;o+=1)r[o]=qe(Ne(e,i,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();t=_e()},l(o){for(let l=0;l<r.length;l+=1)r[l].l(o);t=_e()},m(o,l){for(let s=0;s<r.length;s+=1)r[s].m(o,l);G(o,t,l)},p(o,[l]){if(l&7){i=o[1];let s;for(s=0;s<i.length;s+=1){const y=Ne(o,i,s);r[s]?r[s].p(y,l):(r[s]=qe(y),r[s].c(),r[s].m(t.parentNode,t))}for(;s<r.length;s+=1)r[s].d(1);r.length=i.length}},i:ge,o:ge,d(o){Te(r,o),o&&k(t)}}}function Et(e,t){return[...t.values()].filter(i=>i.parent_group_id===e)}function Bt(e,t,i){let r,o;J(e,Rt,u=>i(4,r=u)),J(e,be,u=>i(5,o=u));let l,s=[null],y,{value:m}=t;const v=(u,a)=>{var d;a.currentTarget.value!=="null"?i(0,m=parseInt(a.currentTarget.value)):i(0,m=(d=s[u-1])!=null?d:null)};return e.$$set=u=>{"value"in u&&i(0,m=u.value)},e.$$.update=()=>{if(e.$$.dirty&32&&i(3,y=u=>{var a;return((a=o.get(u))==null?void 0:a.size)>0}),e.$$.dirty&17){let u=[],a=r.get(m);for(;a;)u=[a.market_group_id,...u],a=r.get(a.parent_group_id);i(2,s=u)}if(e.$$.dirty&30){i(1,l=[[...r.values()].filter(u=>u.parent_group_id==null)]);for(const u of s)y(u)&&i(1,l=[...l,Et(u,r)])}},[m,l,s,y,r,o,v]}class Ot extends le{constructor(t){super();ne(this,t,Bt,Tt,ue,{value:0})}}const{Map:St}=lt;function Fe(e,t,i){const r=e.slice();return r[25]=t[i],r[26]=t,r[27]=i,r}function Le(e,t){let i,r,o,l,s;function y(u){t[23](u,t[25])}function m(u){t[24](u,t[25])}let v={productTypeId:t[25],facilityModifiers:t[7],prices:t[1],extents:t[9]};return t[2].profitRatio[t[25]]!==void 0&&(v.profitRatio=t[2].profitRatio[t[25]]),t[2].profitPerDay[t[25]]!==void 0&&(v.profitPerDay=t[2].profitPerDay[t[25]]),r=new Mt({props:v}),L.push(()=>U(r,"profitRatio",y)),L.push(()=>U(r,"profitPerDay",m)),{key:e,first:null,c(){i=_e(),ie(r.$$.fragment),this.h()},l(u){i=_e(),re(r.$$.fragment,u),this.h()},h(){this.first=i},m(u,a){G(u,i,a),oe(r,u,a),s=!0},p(u,a){t=u;const d={};a&32&&(d.productTypeId=t[25]),a&128&&(d.facilityModifiers=t[7]),a&2&&(d.prices=t[1]),a&512&&(d.extents=t[9]),!o&&a&36&&(o=!0,d.profitRatio=t[2].profitRatio[t[25]],H(()=>o=!1)),!l&&a&36&&(l=!0,d.profitPerDay=t[2].profitPerDay[t[25]],H(()=>l=!1)),r.$set(d)},i(u){s||(x(r.$$.fragment,u),s=!0)},o(u){$(r.$$.fragment,u),s=!1},d(u){u&&k(i),se(r,u)}}}function wt(e){let t,i,r,o,l,s,y,m,v,u,a,d,g,h,b,_,C,I,c,S,Y,A,f,M,E,F,P=[],p=new St,D,V,ee,Re;document.title=t=""+((e[10]&&e[10][e[0]]?`${e[10][e[0]].name} - `:"")+"EVE Online Visual Industry Calculator");function Ue(n){e[18](n)}let ke={};e[4]!==void 0&&(ke.value=e[4]),o=new Ot({props:ke}),L.push(()=>U(o,"value",Ue));function Qe(n){e[20](n)}function ze(n){e[21](n)}let pe={activity:e[8]};e[6]!==void 0&&(pe.value=e[6]),e[7]!==void 0&&(pe.facilityModifiers=e[7]),a=new Pt({props:pe}),L.push(()=>U(a,"value",Qe)),L.push(()=>U(a,"facilityModifiers",ze));let te=e[5];const Ie=n=>n[25];for(let n=0;n<te.length;n+=1){let R=Fe(e,te,n),N=Ie(R);p.set(N,P[n]=Le(N,R))}const de=e[17].default,j=We(de,e,e[16],null);return{c(){i=Q(),r=B("p"),ie(o.$$.fragment),s=B("br"),y=Q(),m=B("button"),v=Z("Compare"),u=Q(),ie(a.$$.fragment),h=Q(),b=B("div"),_=B("div"),C=Q(),I=B("div"),c=B("select"),S=B("option"),Y=Z("Profit Ratio"),A=B("option"),f=Z("Profit per Day"),M=Q(),E=B("div"),F=Q();for(let n=0;n<P.length;n+=1)P[n].c();D=Q(),j&&j.c(),this.h()},l(n){xe('[data-svelte="svelte-1wghn3n"]',document.head).forEach(k),i=z(n),r=O(n,"P",{});var N=w(r);re(o.$$.fragment,N),s=O(N,"BR",{}),y=z(N),m=O(N,"BUTTON",{});var X=w(m);v=W(X,"Compare"),X.forEach(k),N.forEach(k),u=z(n),re(a.$$.fragment,n),h=z(n),b=O(n,"DIV",{class:!0});var K=w(b);_=O(K,"DIV",{class:!0}),w(_).forEach(k),C=z(K),I=O(K,"DIV",{class:!0});var Me=w(I);c=O(Me,"SELECT",{});var he=w(c);S=O(he,"OPTION",{});var Ce=w(S);Y=W(Ce,"Profit Ratio"),Ce.forEach(k),A=O(he,"OPTION",{});var De=w(A);f=W(De,"Profit per Day"),De.forEach(k),he.forEach(k),Me.forEach(k),M=z(K),E=O(K,"DIV",{class:!0});var He=w(E);He.forEach(k),F=z(K);for(let me=0;me<P.length;me+=1)P[me].l(K);K.forEach(k),D=z(n),j&&j.l(n),this.h()},h(){q(_,"class","itemName"),S.__value="profitRatio",S.value=S.__value,A.__value="profitPerDay",A.value=A.__value,e[3]===void 0&&$e(()=>e[22].call(c)),q(I,"class","metricSelector svelte-1no3laa"),q(E,"class","graph"),q(b,"class","compare svelte-1no3laa")},m(n,R){G(n,i,R),G(n,r,R),oe(o,r,null),T(r,s),T(r,y),T(r,m),T(m,v),G(n,u,R),oe(a,n,R),G(n,h,R),G(n,b,R),T(b,_),T(b,C),T(b,I),T(I,c),T(c,S),T(S,Y),T(c,A),T(A,f),ce(c,e[3]),T(b,M),T(b,E),T(b,F);for(let N=0;N<P.length;N+=1)P[N].m(b,null);G(n,D,R),j&&j.m(n,R),V=!0,ee||(Re=[ye(m,"click",e[19]),ye(c,"change",e[22])],ee=!0)},p(n,[R]){(!V||R&1025)&&t!==(t=""+((n[10]&&n[10][n[0]]?`${n[10][n[0]].name} - `:"")+"EVE Online Visual Industry Calculator"))&&(document.title=t);const N={};!l&&R&16&&(l=!0,N.value=n[4],H(()=>l=!1)),o.$set(N);const X={};R&256&&(X.activity=n[8]),!d&&R&64&&(d=!0,X.value=n[6],H(()=>d=!1)),!g&&R&128&&(g=!0,X.facilityModifiers=n[7],H(()=>g=!1)),a.$set(X),R&8&&ce(c,n[3]),R&678&&(te=n[5],nt(),P=et(P,R,Ie,1,n,te,p,b,ut,Le,null,Fe),tt()),j&&j.p&&(!V||R&65536)&&it(j,de,n,n[16],V?ot(de,n[16],R,null):rt(n[16]),null)},i(n){if(!V){x(o.$$.fragment,n),x(a.$$.fragment,n);for(let R=0;R<te.length;R+=1)x(P[R]);x(j,n),V=!0}},o(n){$(o.$$.fragment,n),$(a.$$.fragment,n);for(let R=0;R<P.length;R+=1)$(P[R]);$(j,n),V=!1},d(n){n&&k(i),n&&k(r),se(o),n&&k(u),se(a,n),n&&k(h),n&&k(b);for(let R=0;R<P.length;R+=1)P[R].d();n&&k(D),j&&j.d(n),ee=!1,st(Re)}}}function Gt(e,t,i){let r,o,l,s,y,m,v;J(e,Oe,p=>i(12,l=p)),J(e,Be,p=>i(13,s=p)),J(e,be,p=>i(14,y=p)),J(e,dt,p=>i(15,m=p)),J(e,ve,p=>i(10,v=p));let{$$slots:u={},$$scope:a}=t,d,g=null,h,b={},_=null,C=new Map,I={profitRatio:{},profitPerDay:{}},c="profitRatio",S=d;function Y(p){S=p,i(4,S),i(15,m),i(0,d)}const A=p=>ht(`${S}`,{keepfocus:!0});function f(p){g=p,i(6,g)}function M(p){h=p,i(7,h)}function E(){c=ft(this),i(3,c)}function F(p,D){e.$$.not_equal(I.profitRatio[D],p)&&(I.profitRatio[D]=p,i(2,I))}function P(p,D){e.$$.not_equal(I.profitPerDay[D],p)&&(I.profitPerDay[D]=p,i(2,I))}return e.$$set=p=>{"$$scope"in p&&i(16,a=p.$$scope)},e.$$.update=()=>{if(e.$$.dirty&32785&&(i(0,d=parseInt(m.params.group)||null),!S&&d&&i(4,S=d)),e.$$.dirty&28685&&i(5,r=Ve(d,y,s,l).sort((p,D)=>I[c][D]-I[c][p])),e.$$.dirty&6178){C.clear(),r.forEach(p=>C.set(p,null)),r.map(p=>l.get(p).activity).filter(p=>p!==void 0).forEach(p=>{for(const D in p.materials)C.set(parseInt(D),null);i(8,_=p.activity.activityID)}),C.forEach((p,D)=>{Ee(D).subscribe(V=>{var ee;C.set(D,V),b[D]===void 0&&i(1,b[D]=(ee=V==null?void 0:V.orders.sell[0])==null?void 0:ee.price,b)})});for(let p in C)Ee(parseInt(p)).subscribe(D=>{var V;i(11,C[p]=D,C),b[p]===void 0&&i(1,b[p]=(V=D==null?void 0:D.orders.sell[0])==null?void 0:V.price,b)})}e.$$.dirty&34&&i(9,o=[0,at(r,p=>b[p])*1.2])},[d,b,I,c,S,r,g,h,_,o,v,C,l,s,y,m,a,u,Y,A,f,M,E,F,P]}class Ft extends le{constructor(t){super();ne(this,t,Gt,wt,ue,{})}}export{Ft as default};
